## Context

The OpenSpec workflow manages changes through structured artifact creation (proposal, specs, design, tasks) and implementation (apply). Each change generates valuable implicit knowledge — design decisions, error workarounds, discovered patterns — that is currently lost after archiving. Shodh-Memory is a local Rust-based cognitive memory service that provides semantic remember/recall via REST API at `http://127.0.0.1:3030`.

## Goals / Non-Goals

**Goals:**
- Integrate memory into the existing OpenSpec skill workflow organically (no manual steps)
- Graceful degradation: zero impact when shodh-memory is not installed or running
- Keep the CLI helper minimal — thin wrapper over REST API
- Memory content is generated by the LLM (rich, contextual) not by bash scripts (mechanical)

**Non-Goals:**
- Auto-installing shodh-memory (user responsibility)
- MCP server integration (REST API via bash is sufficient for now)
- Memory management UI in the Control Center
- Cross-repo memory sharing or federation

## Decisions

### Decision 1: SKILL.md modifications over Claude Code hooks
**Choice**: Add memory steps directly to SKILL.md files rather than using bash hooks (UserPromptSubmit/Stop).

**Rationale**: The LLM has full context when executing a skill — it knows what decisions were made, what errors occurred, and what patterns emerged. A bash hook would only see the raw prompt text and could not generate meaningful memory content. SKILL.md steps are also simpler to maintain and debug.

**Alternative considered**: Bash hooks in `.claude/settings.json` — rejected because they lack LLM context and would produce mechanical, low-quality memories.

### Decision 2: Standalone bash helper over inline curl in SKILL.md
**Choice**: Create `wt-memory` as a standalone bash script in `bin/` rather than embedding curl commands in SKILL.md instructions.

**Rationale**: Centralizes API logic, configuration, and graceful degradation. SKILL.md stays clean with simple `wt-memory recall/remember` calls. The helper handles health checks, JSON construction, auth headers, and error suppression in one place.

### Decision 3: Health check gating over try-and-fail
**Choice**: Every memory operation starts with a `wt-memory health` check. If it fails, the operation is a silent no-op.

**Rationale**: Avoids curl timeout delays on every remember/recall call when shodh-memory is not running. A single 1-second health check is cheaper than multiple 2-second timeouts. Also produces cleaner behavior — no partial failures or error messages.

### Decision 4: Stdin-based content passing for remember
**Choice**: `wt-memory remember` reads content from stdin (pipe) rather than command-line arguments.

**Rationale**: Memory content can be multi-line and contain special characters (quotes, backticks). Stdin avoids shell escaping issues entirely. The LLM naturally generates `echo "..." | wt-memory remember` which is clean and readable.

## Risks / Trade-offs

- **[Health check latency]** Each memory step adds ~1 second if shodh-memory is not running (health check timeout). Mitigation: timeout is set to 1 second, and this only occurs at the skill-level boundaries (not per-task).
- **[Memory quality depends on LLM]** The quality of saved memories depends entirely on the LLM's judgment about what is worth remembering. Mitigation: SKILL.md instructions are specific about what to save (decisions, errors, patterns, events).
- **[No memory pruning]** There is no built-in mechanism to prune stale or incorrect memories. Mitigation: Shodh-Memory's semantic search naturally surfaces recent/relevant results; old irrelevant memories will rank low.
